@page "/chat"
@inject ChatService ChatService

<MudText Typo="Typo.h5" Class="mb-2">💬 Live Chat with Reception</MudText>

@if (isSending)
{
    <MudProgressCircular Indeterminate="true" Class="my-2" />
}

<MudTextField @bind-Value="messageText" Placeholder="Type your message..." Class="mb-2" Immediate="true" />
<MudButton Color="Color.Primary" OnClick="SendMessage" Disabled="@string.IsNullOrWhiteSpace(messageText)">📩 Send</MudButton>

@if (!string.IsNullOrEmpty(feedbackMessage))
{
    <MudText Color="Color.Success" Class="mt-2">@feedbackMessage</MudText>
}

@code {
    private string messageText = "";
    private bool isSending = false;
    private string feedbackMessage = "";

    private async Task SendMessage()
    {
        if (!string.IsNullOrEmpty(messageText))
        {
            isSending = true;
            var success = await ChatService.SendMessage(messageText);
            isSending = false;

            if (success)
            {
                feedbackMessage = "✅ Message sent!";
                messageText = "";
            }
            else
            {
                feedbackMessage = "❌ Failed to send message.";
            }
        }
    }
}
